# NadVibS
This program was used for and is cited by [this research paper](https://doi.org/10.1063/5.0214635) published in the Journal of Chemical Physics.
This package is used to simulate the anion ultraviolet photoelectron spectrum of molecules with strongly coupled low-lying electronic states.
It diagonalizes the diabatic vibronic Hamiltonian, determines Franck-Condon overlaps, and generates an input file for BROOKLYN to calculate spin-orbit fine structure.
It originates from NADVIBS.X by former [Yarkony Group](https://github.com/yarkonygrp/) member [Michael Schuurman](https://github.com/mschuurman) in 2007, who is now leading [Schuurman Group](https://github.com/schuurman-group).

## Python utilities
| File  | Description |
| ------------- | ------------- |
| extract.py | <ul><li>Extracts spectral data from NadVibS output</li><li>Required argument: input</li></ul> |
| convolve.py |<ul><li>Performs convolution</li><li>Required arguments: start, stop, input (generated by extract.py), aperture, sigma</li></ul> |
| modify.py | <ul><li>Renormalizes, rescales, inverts, and shifts the spectrum</li><li>Throws out the lines with zero intensity</li><li>Required argument: input (generated by extract.py or convolve.py)</li></ul> |
| plot.py | <ul><li>Plots the simulated line spectrum</li><li>Plots the continuous spectrum</li></ul> |

## Usage
To run NadVibS, use the command: mpirun -hostfile hostfile -np `#CPU` `NadVibSDirectory`/NadVibS.exe -m `MemoryInMB` -o `OutputDirectory` > log

NadVibS requires 2 input files: nadvibs.in and basis.in (as well as restart.log if not restart = 0).
An example is provided.
nadvibs.in will be automatically generated by [SurfgenBound 2](https://github.com/cavanes1/SurfgenBound2).
Python scripts are simple: Use -h argument to show the help message.

The user has to take care of the FORTRAN namelist file basis.in:

| Keyword  | Default | Meaning |
| ------------- | ------------- | ------------- |
| restart   | | 0, new job; else, restart |
| niter     | | number of lanczos iterations to be performed |
| basis     | | number of basis functions for each vibrational mode |
| initstate | | the initial vibrational state of the precursor (specified by the quanta of each precursor normal mode) |
| nstates   | | number of electronic states |
| ordr      | | order of the expansion for diabatic hamiltonian |
| natoms    | | number of atoms in molecule |
| nmodes    | | number of vibrational modes |
| nirreps   | | number of irreducible representations in point group symmetry |
| npirr     | | number of normal modes in each irreducible representation |
| shiftref  | | 0, do not use new origin; else, use new origin |
| bconv     | 0 | -lg( convergence tolerence for eigen value ) |
| idroots   | 0 | how many of the lead contributors to a vibronic level to identify, and this also defines how many vibronic levels to perform this identification on |
| soroots   | 0 | number of roots to compute spin orbit parameters |
| reorthog  | 0 | >0, request re-orthogonalization; >1, exact dot products are to be used to monitor lanczos vector orthogonality  |
| chkorthog | 100 | every how many iterations compute exact dot products if using recurrence |
| nseg      | 1 | number of segements to divide lanczos vector into |
| ztoler    | 1d-20 | Any coefficient less ztoler is set to 0 |
| maxdisk   | 1000 | maximum amount of disk available for use (in MB) |
| weights   | 1 | initial weights of the electronic states |

### Dependency
Global Arrays 5.4 or later
